---
## Front matter
title: "Отчёт по лабораторной работе №5"
subtitle: "Управление системными службами"
author: "Лабси Мохаммед"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true
toc-depth: 2
lof: true
lot: true
fontsize: 12pt
linestretch: 1.5
papersize: a4
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
    - spelling=modern
    - babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float}
  - \floatplacement{figure}{H}
---

# Цель работы

Получить навыки управления системными службами операционной системы посредством systemd.

# Ход выполнения

## Управление сервисами

1. Получены полномочия администратора с помощью команды **su -**.  
   После ввода пароля открыт сеанс суперпользователя *root*, что позволило управлять системными службами.

2. Выполнена проверка состояния службы **Very Secure FTP** с помощью команды  
   **systemctl status vsftpd**.  
   В результате получено сообщение о том, что юнит **vsftpd.service** не найден, что свидетельствует об отсутствии установленного сервиса в системе.

3. Установлен сервис **Very Secure FTP** с использованием пакетного менеджера командой  
   **dnf -y install vsftpd**.  
   В процессе установки были разрешены зависимости, загружен и установлен пакет *vsftpd* из репозитория *appstream*.

   ![Установка сервиса vsftpd с помощью dnf](Screenshot_1.png){ #fig:002 width=80% }

4. Служба **vsftpd** была запущена командой **systemctl start vsftpd**.  
   После запуска выполнена повторная проверка статуса.

5. Проверка состояния службы с помощью **systemctl status vsftpd** показала, что сервис находится в состоянии *active (running)*, однако параметр загрузки при старте системы имеет значение *disabled*, то есть служба не будет автоматически запущена после перезагрузки.

   ![Запуск и проверка статуса сервиса vsftpd](Screenshot_2.png){ #fig:003 width=80% }

6. Для добавления службы **vsftpd** в автозапуск выполнена команда **systemctl enable vsftpd**.  
   В результате была создана символическая ссылка в каталоге */etc/systemd/system/multi-user.target.wants/*.  
   Повторная проверка статуса показала изменение состояния загрузки с *disabled* на *enabled*.  
   После этого служба была удалена из автозапуска с помощью команды **systemctl disable vsftpd**, что подтвердилось повторным выводом статуса.

   ![Включение и отключение автозапуска сервиса vsftpd](Screenshot_3.png){ #fig:004 width=80% }

7. Выполнен просмотр списка символических ссылок, отвечающих за запуск сервисов на уровне *multi-user.target*, командой  
   **ls /etc/systemd/system/multi-user.target.wants/**.  
   В выводе команды отсутствовала ссылка на **vsftpd.service**, что подтверждает корректное отключение автозапуска.

8. Служба **vsftpd** повторно добавлена в автозапуск командой **systemctl enable vsftpd**.  
   После этого при повторном выводе содержимого каталога *multi-user.target.wants* появилась символическая ссылка на файл */usr/lib/systemd/system/vsftpd.service*.

9. Повторная проверка состояния службы с помощью **systemctl status vsftpd** показала, что сервис находится в состоянии *active (running)*, а параметр загрузки изменён на *enabled*.

   ![Статус сервиса vsftpd после повторного включения автозапуска](Screenshot_4.png){ #fig:006 width=80% }

10. Выведен список зависимостей юнита **vsftpd** командой  
    **systemctl list-dependencies vsftpd**.  
    В результате отображены целевые юниты и сервисы, от которых зависит работа данного сервиса.

11. Выведен список юнитов, которые зависят от **vsftpd**, с использованием команды  
    **systemctl list-dependencies vsftpd --reverse**.  
    В выводе отображены цели *multi-user.target* и *graphical.target*, что указывает на использование сервиса на соответствующих уровнях загрузки.

   ![Просмотр прямых и обратных зависимостей сервиса vsftpd](Screenshot_5.png){ #fig:007 width=80% }

## Конфликты юнитов

1. Получены полномочия администратора и установлен пакет **iptables** с помощью команды  
   **dnf -y install iptables\***.  
   В процессе установки были обновлены и добавлены необходимые компоненты подсистемы фильтрации пакетов.

2. Проверено состояние сервисов **firewalld** и **iptables** с помощью команд  
   **systemctl status firewalld** и **systemctl status iptables**.  
   Служба *firewalld* находилась в состоянии *active (running)*, в то время как *iptables* была неактивна.

   ![Проверка статуса firewalld и iptables](Screenshot_6.png){ #fig:008 width=80% }

3. Выполнена попытка запуска обеих служб командами  
   **systemctl start firewalld** и **systemctl start iptables**.  
   При этом наблюдается конфликт: одновременная работа данных сервисов невозможна, так как они используют одни и те же механизмы фильтрации сетевых пакетов.

4. Выполнен просмотр файла юнита **firewalld** с помощью команды  
   **cat /usr/lib/systemd/system/firewalld.service**.  
   В описании юнита присутствует директива **Conflicts**, указывающая на несовместимость с сервисами *iptables*, *ip6tables*, *ebtables* и *ipset*.

   ![Просмотр конфигурации юнита firewalld](Screenshot_7.png){ #fig:009 width=80% }

5. Выполнен просмотр файла юнита **iptables** командой  
   **cat /usr/lib/systemd/system/iptables.service**.  
   Данный юнит предназначен для инициализации правил iptables и привязывается к цели *multi-user.target*, что подтверждает его конфликт с *firewalld*.

   ![Просмотр конфигурации юнита iptables](Screenshot_8.png){ #fig:010 width=80% }

6. Для исключения конфликта служба **iptables** была остановлена командой  
   **systemctl stop iptables**, после чего служба **firewalld** была успешно запущена командой **systemctl start firewalld**.

7. Для предотвращения случайного запуска сервиса **iptables** выполнена команда  
   **systemctl mask iptables**.  
   В результате была создана символическая ссылка на */dev/null* для файла */etc/systemd/system/iptables.service*, что делает запуск сервиса невозможным.

8. Попытка запуска замаскированной службы с помощью **systemctl start iptables** завершилась ошибкой, указывающей на то, что сервис замаскирован и не может быть запущен.

9. Попытка добавления сервиса **iptables** в автозапуск с помощью **systemctl enable iptables** также завершилась ошибкой, при этом статус службы отображается как *masked*, что подтверждает корректность выполненных действий.

   ![Маскирование сервиса iptables и попытки его запуска](Screenshot_9.png){ #fig:011 width=80% }

## Изолируемые цели systemd

1. Получены полномочия администратора и выполнен переход в каталог с системными юнитами systemd с помощью команды **cd /usr/lib/systemd/system**.  
   Для определения целей, которые могут быть изолированы, выполнен поиск директивы **AllowIsolate** в файлах целей командой **grep Isolate *.target**.  
   В результате получен список целей, для которых параметр *AllowIsolate=yes*, что указывает на возможность их изоляции и установки в качестве цели по умолчанию. Среди них присутствуют *multi-user.target*, *graphical.target*, *rescue.target*, *reboot.target* и другие.

   ![Список изолируемых целей systemd](Screenshot_10.png){ #fig:012 width=80% }

2. Выполнено переключение операционной системы в режим восстановления с помощью команды  
   **systemctl isolate rescue.target**.  
   После выполнения команды система перешла в *rescue mode*, при этом для продолжения работы потребовалось ввести пароль пользователя *root* на системной консоли.

   ![Переход системы в режим восстановления rescue.target](Screenshot_11.png){ #fig:013 width=80% }

3. Выполнен перезапуск операционной системы путём изоляции цели **reboot.target** с помощью команды  
   **systemctl isolate reboot.target**.  
   В результате система была корректно перезагружена.

## Цель по умолчанию

4. После загрузки системы получены полномочия администратора и выполнена проверка цели, установленной по умолчанию, командой **systemctl get-default**.  
   В выводе команды указано, что текущей целью по умолчанию является *graphical.target*.

5. Для установки текстового режима загрузки по умолчанию выполнена команда  
   **systemctl set-default multi-user.target**.  
   В результате была удалена существующая символическая ссылка */etc/systemd/system/default.target* и создана новая ссылка на файл */usr/lib/systemd/system/multi-user.target*.

   ![Установка multi-user.target в качестве цели по умолчанию](Screenshot_12.png){ #fig:014 width=80% }

6. После перезагрузки системы выполнен повторный вход с правами администратора и снова выполнена команда **systemctl get-default**.  
   Результат подтвердил, что система загрузилась в текстовом режиме с целью *multi-user.target*.

7. Для возврата графического режима загрузки по умолчанию выполнена команда  
   **systemctl set-default graphical.target**.  
   В результате была создана символическая ссылка на файл */usr/lib/systemd/system/graphical.target*. После очередной перезагрузки системы подтверждено, что загрузка происходит в графическом режиме.

   ![Установка graphical.target в качестве цели по умолчанию](Screenshot_13.png){ #fig:015 width=80% }

## Контрольные вопросы

1. **Что такое юнит (unit)? Приведите примеры.**  
   Юнит — это основной объект управления в системе **systemd**, представляющий собой описание ресурса, службы или состояния системы.  
   Юниты определяют, *как* и *когда* должны запускаться различные компоненты операционной системы.  
   Примеры юнитов:  
   – **service** — сервисы и демоны (например, *vsftpd.service*, *sshd.service*);  
   – **target** — логические группы юнитов и уровни загрузки (например, *multi-user.target*, *graphical.target*);  
   – **mount** — точки монтирования файловых систем (например, *home.mount*);  
   – **socket** — сокеты для активации сервисов (например, *sshd.socket*).

2. **Какая команда позволяет убедиться, что цель больше не входит в список автоматического запуска при загрузке системы?**  
   Для проверки цели, установленной по умолчанию, используется команда **systemctl get-default**.  
   Если в выводе отсутствует проверяемая цель, значит она не используется для автоматического запуска при загрузке системы.

3. **Какую команду вы должны использовать для отображения всех сервисных юнитов, которые в настоящее время загружены?**  
   Для отображения всех загруженных сервисных юнитов используется команда  
   **systemctl list-units --type=service**.  
   Она выводит список активных и загруженных сервисов с указанием их текущего состояния.

4. **Как создать потребность (wants) в сервисе?**  
   Потребность (*Wants*) в сервисе создаётся путём добавления директивы **Wants=** в конфигурационный файл другого юнита  
   либо с помощью команды **systemctl enable <service>**, которая создаёт соответствующую символическую ссылку между юнитами.

5. **Как переключить текущее состояние на цель восстановления (rescue target)?**  
   Для перехода в режим восстановления используется команда  
   **systemctl isolate rescue.target**.  
   При этом система останавливает большинство сервисов и запрашивает пароль пользователя *root* для продолжения работы.

6. **Поясните причину получения сообщения о том, что цель не может быть изолирована.**  
   Такое сообщение появляется, если в файле цели отсутствует директива **AllowIsolate=yes**.  
   Это означает, что данная цель не предназначена для изоляции и не может быть запущена отдельно со всеми своими зависимостями.

7. **Вы хотите отключить службу systemd, но перед этим необходимо узнать, какие другие юниты зависят от неё. Какую команду следует использовать?**  
   Для просмотра юнитов, зависящих от выбранного сервиса, используется команда  
   **systemctl list-dependencies <service> --reverse**.  
   Она выводит список всех юнитов, для которых данный сервис является зависимостью.

# Заключение

В ходе лабораторной работы были изучены принципы управления системными службами и целями в системе **systemd**. Освоены операции установки, запуска, остановки и добавления сервисов в автозапуск, а также анализ их состояний и зависимостей. На практике рассмотрены изолируемые цели, механизм переключения режимов работы системы и изменение цели загрузки по умолчанию. Кроме того, изучены конфликты юнитов на примере сервисов **firewalld** и **iptables** и методы предотвращения их одновременного запуска. Полученные навыки позволяют эффективно администрировать службы и управлять процессом загрузки операционной системы.
