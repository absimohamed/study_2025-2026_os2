---
## Front matter
title: "Отчёт по лабораторной работе №15"
subtitle: "Управление логическими томами"
author: "Лабси Мохаммед"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true
toc-depth: 2
lof: true
lot: true
fontsize: 12pt
linestretch: 1.5
papersize: a4
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
    - spelling=modern
    - babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float}
  - \floatplacement{figure}{H}
---

# Цель работы

Получить навыки управления логическими томами.

# Ход выполнения

## Создание физического тома

1. С помощью утилиты fdisk на диске /dev/sdb создан новый основной раздел размером 300 MiB. Тип раздела изменён на «Linux LVM». Разметка была сохранена.

2. После обновления таблицы разделов диск был определён системой повторно. Создан новый физический том LVM на основе раздела.

   ![Создание PV на sdb1](Screenshot_1.png){ #fig:001-2 width=80% }

## Создание группы томов и логических томов

1. На основе созданного физического тома сформирована группа томов vgdata.  
   Вывод списка групп и физических томов подтверждает корректность операций.

   ![Создание VG и проверка PV/VG](Screenshot_2.png){ #fig:002 width=80% }

2. Внутри группы томов создан логический том lvdata, использующий 50% свободного пространства.  
   Затем на нём была создана файловая система ext4.

3. Создан каталог /mnt/data, после чего в файл /etc/fstab добавлена строка для автоматического монтирования логического тома.  
   Проверка показала, что система успешно подключила файловую систему.

   ![Добавление записи в fstab](Screenshot_3.png){ #fig:003-2 width=80% }

   ![Проверка монтирования LV](Screenshot_4.png){ #fig:004 width=80% }

## Изменение размера логических томов

1. Текущая конфигурация физических томов и групп томов была проанализирована.  
   Далее выполнено создание нового раздела /dev/sdb2 размером 300 MiB с типом «Linux LVM».

   ![Создание раздела sdb2](Screenshot_5.png){ #fig:005 width=80% }

2. На новом разделе создан физический том, а затем группа томов vgdata была расширена за счёт добавления второго физического тома.

   ![Добавление PV и расширение VG](Screenshot_6.png){ #fig:006 width=80% }

3. После обновления группы проверены размеры томов и доступное пространство.  
   Затем логический том lvdata увеличен на 50% оставшегося свободного места. Файловая система расширена автоматически.

   ![Увеличение LV и расширение ФС](Screenshot_7.png){ #fig:007 width=80% }

4. Новые размеры логического тома и файловой системы подтверждены проверкой.  
   Затем выполнено уменьшение размера логического тома на 50 MiB. В процессе том был временно размонтирован и смонтирован снова.

   ![Уменьшение размера LV](Screenshot_8.png){ #fig:008 width=80% }

5. Итоговое состояние логического тома и файловой системы соответствует ожидаемым параметрам.

## Самостоятельная работа

### Создание логического тома и его постоянное монтирование

1. На диске /dev/sdc с помощью fdisk были созданы два раздела: /dev/sdc1 и /dev/sdc2.  
   Оба раздела получили тип «Linux LVM». Разметка была сохранена.

   ![Разметка диска sdc и изменение типа разделов](Screenshot_9.png){ #fig:009 width=80% }

2. На разделе /dev/sdc1 был создан физический том. Затем на его основе сформирована группа томов vggroup.  
   После этого создан логический том lvgroup размером 200 МБ, которому было выделено всё доступное пространство в группе.

   ![Создание PV, VG и LV](Screenshot_10.png){ #fig:010 width=80% }

3. На логическом томе lvgroup была создана файловая система XFS.  
   Форматирование прошло успешно, что подтверждено выводом информации о параметрах XFS.

   ![Форматирование LV в XFS](Screenshot_10.png){ #fig:010-2 width=80% }

4. В файл /etc/fstab была добавлена строка для постоянного монтирования тома lvgroup в каталог /mnt/groups.  
   После обновления файла система успешно применила изменения.

   ![Добавление записи в fstab](Screenshot_11.png){ #fig:011 width=80% }

5. Проверка монтирования показала, что файловая система XFS подключена к /mnt/groups.  
   Параметры: чтение-запись, relatime, seclabel и дополнительные атрибуты XFS.

   ![Проверка монтирования и df -h](Screenshot_12.png){ #fig:012 width=80% }

### Увеличение размера тома и файловой системы

1. После перезагрузки системы был добавлен новый раздел /dev/sdc2, который также преобразован в физический том.  
   Группа vggroup была расширена путём добавления нового PV, что увеличило доступный объём для выделения логическим томам.

   ![Создание второго PV и расширение VG](Screenshot_13.png){ #fig:013 width=80% }

2. Логический том lvgroup был расширен на 150 МБ за счёт свободного пространства группы.  
   Одновременно с этим была увеличена файловая система XFS на томе, что позволило избежать необходимости ручного перемонтирования.

   ![Расширение LV и файловой системы XFS](Screenshot_13.png){ #fig:013-2 width=80% }

3. Проверка состояния физических томов, групп томов и логических томов показала корректное увеличение доступного пространства.  
   Вывод информации о файловых системах подтвердил новый размер тома lvgroup, смонтированного в /mnt/groups.

   ![Проверка PV, VG, LV и размера файловой системы](Screenshot_14.png){ #fig:014 width=80% }

### Подтверждение результата

1. Размер логического тома lvgroup увеличился и теперь превышает 900 МБ.  
2. Файловая система XFS также выросла пропорционально расширению тома.  
3. Файловая система остаётся подключённой к каталогу /mnt/groups после перезагрузки.  

   ![Финальная проверка результата](Screenshot_15.png){ #fig:015 width=80% }

## Контрольные вопросы

1. **Какой тип раздела используется в разделе GUID для работы с LVM?**
   Для LVM в схемe GPT используется тип раздела **8e00 (Linux LVM)**.

2. **Какой командой можно создать группу томов с именем vggroup, которая содержит физическое устройство /dev/sdb3 и использует физический экстент 4 MiB?**
   Группа томов создаётся командой **vgcreate vggroup /dev/sdb3 --physicalextentsize 4M**.

3. **Какая команда показывает краткую сводку физических томов в вашей системе, а также группу томов, к которой они принадлежат?**
   Краткую сводку физических томов предоставляет команда **pvs**.

4. **Что вам нужно сделать, чтобы добавить весь жёсткий диск /dev/sdd в группу томов группы?**
   Сначала нужно создать физический том на диске (**pvcreate /dev/sdd**),
   а затем расширить группу томов командой **vgextend <имя_группы> /dev/sdd**.

5. **Какая команда позволяет вам создать логический том lvvol1 с размером 6 MiB?**
   Логический том создаётся командой **lvcreate -n lvvol1 -L 6M <имя_группы>**.

6. **Какая команда позволяет вам добавить 100 МБ в логический том lvvol1, если дисковое пространство доступно в группе томов?**
   Для увеличения размера тома используется команда **lvextend -L +100M /dev/<группа>/lvvol1**.

7. **Каков первый шаг, чтобы добавить ещё 200 МБ дискового пространства в логический том, если требуемое пространство недоступно в группе томов?**
   Сначала нужно увеличить свободное пространство группы томов,
   добавив в неё новый физический том через **pvcreate** и **vgextend**.

8. **Какую опцию нужно использовать с командой lvextend, чтобы также изменить размер файловой системы?**
   Для автоматического расширения файловой системы применяется опция **-r**.

9. **Как посмотреть, какие логические тома доступны?**
   Для просмотра списка логических томов используется команда **lvs**.

10. **Какую команду нужно использовать для проверки целостности файловой системы на /dev/vgdata/lvdata?**
    Проверка выполняется утилитой **fsck**, например: **fsck /dev/vgdata/lvdata**.

# Заключение

В ходе выполнения работы были изучены и practically освоены основные операции по управлению логической структурой хранения данных в Linux. Созданы и настроены физические тома, группы томов и логические тома, выполнено их форматирование в файловые системы ext4 и XFS, а также организовано постоянное монтирование через системный файл fstab.  
Отдельное внимание было уделено динамическому изменению размеров логических томов: выполнено как расширение, так и уменьшение томов с одновременным изменением размеров файловых систем.  
